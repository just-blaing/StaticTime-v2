<Window x:Class="statictime.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:statictime"
        Title="StaticTime" Height="876" Width="478"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        ResizeMode="CanResize"
        MaxWidth="478" MaxHeight="876" MinWidth="300" MinHeight="400"
        x:Name="window"
        SizeChanged="change_size">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40" ResizeBorderThickness="5" GlassFrameThickness="0" CornerRadius="0"/>
    </WindowChrome.WindowChrome>
    <Window.Resources>
        <local:theme_to_bool_converter x:Key="themeToBoolConverter"/>
        <Style TargetType="Button" x:Key="navButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{Binding ElementName=window, Path=Tag}"/> 
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="5" Padding="10,5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#22888888"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.3"/>
                    <Setter Property="Cursor" Value="Arrow"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style TargetType="ToggleButton" x:Key="themeButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{Binding ElementName=window, Path=Tag}"/> 
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="5" Padding="10,5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#22888888"/>
                    <Setter Property="BorderBrush" Value="#888888"/>
                </Trigger>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="BorderBrush" Value="#aa55ff"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="LayoutTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1.3" ScaleY="1.3"/>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="#333"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="5"/>
        </Style>
        <Style TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ScrollContentPresenter Grid.Column="0" Margin="0,0,5,0"/>
                            <ScrollBar x:Name="PART_VerticalScrollBar" Grid.Column="1" Width="6" Maximum="{TemplateBinding ScrollableHeight}" ViewportSize="{TemplateBinding ViewportHeight}" Value="{TemplateBinding VerticalOffset}" Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Border x:Name="root_border" Background="#1e1e1e" CornerRadius="15" BorderBrush="#333" BorderThickness="1" Margin="5" UseLayoutRounding="True">
        <Border.Effect>
            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0.4" Color="Black"/>
        </Border.Effect>
        <Grid>
            <Canvas x:Name="theme_layer" Panel.ZIndex="0" IsHitTestVisible="False">
                <Ellipse x:Name="theme_spreader" Width="0" Height="0" Fill="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Canvas>
            <Grid Panel.ZIndex="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="40"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0" Background="Transparent" MouseLeftButtonDown="drag_window">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="10,0,0,0">
                        <Button x:Name="btn_menu" Content="☰" Click="menu" Style="{StaticResource navButton}" FontSize="16" Padding="5" WindowChrome.IsHitTestVisibleInChrome="True"/>
                    </StackPanel>
                    <TextBlock x:Name="title" Text="StaticTime v2.1" Foreground="{Binding ElementName=window, Path=Tag}" VerticalAlignment="Center" HorizontalAlignment="Center" FontWeight="Bold"/>
                    <Button Content="✕" Click="close" Style="{StaticResource navButton}" HorizontalAlignment="Right" Margin="0,0,10,0" Foreground="#ff5555" Padding="5" WindowChrome.IsHitTestVisibleInChrome="True"/>
                </Grid>
                <Grid Grid.Row="1" Margin="10">
                    <Grid x:Name="panel_main">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0" Margin="10,0,10,15" Panel.ZIndex="10">
                            <TextBlock x:Name="total_hours" Text="0ч" FontSize="28" Foreground="#aa55ff" VerticalAlignment="Center" HorizontalAlignment="Center" FontWeight="Bold"/>
                            <Grid VerticalAlignment="Center" HorizontalAlignment="Right">
                                <Button x:Name="time_filter" Content="всё время ▼" Click="show_time_categories" Style="{StaticResource navButton}" FontSize="12" Focusable="False"/>
                                <Popup x:Name="categories" PlacementTarget="{Binding ElementName=time_filter}" Placement="Bottom" AllowsTransparency="True" HorizontalOffset="-50" StaysOpen="True">
                                    <Border x:Name="border" Background="#252525" CornerRadius="5" BorderBrush="#444" BorderThickness="1" Margin="0,5,0,0" Padding="5">
                                        <StackPanel>
                                            <Button Content="сегодня" Click="today" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" Focusable="False"/>
                                            <Button Content="вчера" Click="yesterday" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" Focusable="False"/>
                                            <Button Content="неделя" Click="week" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" Focusable="False"/>
                                            <Button Content="месяц" Click="month" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" Focusable="False"/>
                                            <Button Content="год" Click="year" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" Focusable="False"/>
                                            <Button Content="всё время" Click="all_time" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" Focusable="False"/>
                                        </StackPanel>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Grid>
                        <Grid Grid.Row="1" Background="Transparent">
                            <Grid x:Name="panel_list" Visibility="Visible">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ItemsControl x:Name="list_apps">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Margin="2,5" x:Name="item_grid" Background="#11888888">
                                                    <Grid.ContextMenu>
                                                        <ContextMenu>
                                                            <MenuItem Header="заблокировать" Click="add_to_blacklist"
                                                                      Tag="{Binding RelativeSource={RelativeSource AncestorType=ContextMenu}, Path=PlacementTarget.DataContext}"/>
                                                        </ContextMenu>
                                                    </Grid.ContextMenu>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="40"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Image Source="{Binding icon}" Width="24" Height="24" Margin="5"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding display_name}" Foreground="{Binding Path=Tag, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" VerticalAlignment="Center" Margin="5,0,0,0" TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="2" Text="{Binding time}" Foreground="#888" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </Grid>
                    </Grid>
                    <Grid x:Name="overlay" Background="#01000000" Visibility="Collapsed" Panel.ZIndex="20" MouseLeftButtonDown="click_overlay">
                         <Border Width="220" HorizontalAlignment="Left" x:Name="panel" Background="#222" BorderBrush="#444" BorderThickness="0,0,1,0" MouseLeftButtonDown="prevent_close">
                             <Border.RenderTransform>
                                 <TranslateTransform x:Name="transform" X="-220"/>
                             </Border.RenderTransform>
                             <Grid Margin="15">
                                 <Grid.RowDefinitions>
                                     <RowDefinition Height="Auto"/>
                                     <RowDefinition Height="Auto"/>
                                     <RowDefinition Height="*"/>
                                     <RowDefinition Height="Auto"/>
                                 </Grid.RowDefinitions>
                                 <TextBlock Grid.Row="0" Text="меню" Foreground="#666" Margin="0,10,0,20" FontWeight="Bold"/>
                                 <StackPanel Grid.Row="1">
                                    <Button Content="главная" Click="home" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left"/>
                                    <Button Content="статистика" Click="stats" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Margin="0,5"/>
                                 </StackPanel>
                                 <StackPanel Grid.Row="3">
                                    <Button Content="настройки" Click="settings" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Margin="0,5"/>
                                    <Button Content="гитхаб" Click="open_github" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Margin="0,5"/>
                                    <Button Content="выйти" Click="exit" Style="{StaticResource navButton}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Foreground="#ff5555"/>
                                 </StackPanel>
                             </Grid>
                         </Border>
                    </Grid>
                    <Grid x:Name="panel_stats" Visibility="Collapsed" Panel.ZIndex="15">
                        <StackPanel Margin="20">
                            <Button Content="← назад" Click="close_stats" Style="{StaticResource navButton}" HorizontalAlignment="Left" Margin="0,0,0,20"/>
                            <TextBlock Text="статистика" FontSize="20" Foreground="{Binding ElementName=window, Path=Tag}" Margin="0,0,0,20"/>
                            <ScrollViewer MaxHeight="600" VerticalScrollBarVisibility="Hidden">
                                <StackPanel>
                                    <Border Background="#11888888" CornerRadius="5" Padding="10" Margin="0,5">
                                        <TextBlock x:Name="stats_alt" Text="вы нажали Alt + Tab: 0" Foreground="{Binding ElementName=window, Path=Tag}" FontSize="14"/>
                                    </Border>
                                    <Border Background="#11888888" CornerRadius="5" Padding="10" Margin="0,5">
                                        <TextBlock x:Name="stats_afk" Text="вы пробыли в афк: 0с" Foreground="{Binding ElementName=window, Path=Tag}" FontSize="14"/>
                                    </Border>
                                    <Border Background="#11888888" CornerRadius="5" Padding="10" Margin="0,5">
                                        <TextBlock x:Name="stats_lmb" Text="вы нажали лкм: 0" Foreground="{Binding ElementName=window, Path=Tag}" FontSize="14"/>
                                    </Border>
                                    <Border Background="#11888888" CornerRadius="5" Padding="10" Margin="0,5">
                                        <TextBlock x:Name="stats_rmb" Text="вы нажали пкм: 0" Foreground="{Binding ElementName=window, Path=Tag}" FontSize="14"/>
                                    </Border>
                                    <Border Background="#11888888" CornerRadius="5" Padding="10" Margin="0,5">
                                        <TextBlock x:Name="stats_scroll" Text="вы пролистали: 0см" Foreground="{Binding ElementName=window, Path=Tag}" FontSize="14"/>
                                    </Border>
                                    <TextBlock Text="топ слов:" Foreground="#666" Margin="0,15,0,5" FontWeight="Bold"/>
                                    <ItemsControl x:Name="list_words">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#11888888" CornerRadius="5" Padding="10" Margin="0,2">
                                                    <TextBlock Text="{Binding}" Foreground="{Binding Path=Tag, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" FontSize="13"/>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ScrollViewer>
                        </StackPanel>
                    </Grid>
                    <Grid x:Name="panel_settings" Visibility="Collapsed" Panel.ZIndex="15">
                         <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="20">
                                <Button Content="← назад" Click="close_settings" Style="{StaticResource navButton}" HorizontalAlignment="Left"/>
                                <StackPanel Margin="0,20,0,0">
                                    <TextBlock Text="тема приложения:" Foreground="{Binding ElementName=window, Path=Tag}" Margin="0,0,0,5"/>
                                    <WrapPanel>
                                        <ToggleButton x:Name="theme_dark" Content="тёмная" Click="set_theme_dark" Margin="0,0,5,5" Style="{StaticResource themeButton}" Background="#333" Foreground="White" IsChecked="{Binding Path=current_theme, Converter={StaticResource themeToBoolConverter}, ConverterParameter=dark}"/>
                                        <ToggleButton x:Name="theme_white" Content="светлая" Click="set_theme_white" Margin="0,0,5,5" Style="{StaticResource themeButton}" Background="#ddd" Foreground="Black" IsChecked="{Binding Path=current_theme, Converter={StaticResource themeToBoolConverter}, ConverterParameter=white}"/>
                                        <ToggleButton x:Name="theme_amoled" Content="amoled" Click="set_theme_amoled" Margin="0,0,5,5" Style="{StaticResource themeButton}" Background="Black" Foreground="White" IsChecked="{Binding Path=current_theme, Converter={StaticResource themeToBoolConverter}, ConverterParameter=amoled}"/>
                                    </WrapPanel>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                                    <CheckBox x:Name="check_autostart" Click="autostart" VerticalAlignment="Center"/>
                                    <TextBlock Text="автозапуск (silent)" Foreground="{Binding ElementName=window, Path=Tag}" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                                    <CheckBox x:Name="check_showexe" Click="showexe" VerticalAlignment="Center"/>
                                    <TextBlock Text="показывать .exe файла" Foreground="{Binding ElementName=window, Path=Tag}" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                                    <CheckBox x:Name="check_fulltime" Click="fulltime" VerticalAlignment="Center"/>
                                    <TextBlock Text="показывать полное время" Foreground="{Binding ElementName=window, Path=Tag}" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                                    <CheckBox x:Name="check_topmost" Click="topmost" VerticalAlignment="Center"/>
                                    <TextBlock Text="поверх всех окон" Foreground="{Binding ElementName=window, Path=Tag}" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                                    <CheckBox x:Name="check_noicons" Click="noicons" VerticalAlignment="Center"/>
                                    <TextBlock Text="показывать окна без иконок" Foreground="{Binding ElementName=window, Path=Tag}" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                                    <CheckBox x:Name="check_overlay" Click="overlay_mode" VerticalAlignment="Center"/>
                                    <TextBlock Text="режим оверлея" Foreground="{Binding ElementName=window, Path=Tag}" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                </StackPanel>
                                <StackPanel Margin="0,20,0,0">
                                    <TextBlock Text="автообновление:" Foreground="{Binding ElementName=window, Path=Tag}" Margin="0,0,0,5"/>
                                    <ComboBox x:Name="refresh" SelectionChanged="change_rrate" Width="100" HorizontalAlignment="Left">
                                        <ComboBoxItem Content="1 сек"/>
                                        <ComboBoxItem Content="5 сек"/>
                                        <ComboBoxItem Content="10 сек"/>
                                        <ComboBoxItem Content="30 сек"/>
                                        <ComboBoxItem Content="60 сек"/>
                                    </ComboBox>
                                </StackPanel>
                                <StackPanel Margin="0,20,0,0">
                                    <TextBlock Text="черный список:" Foreground="{Binding ElementName=window, Path=Tag}" Margin="0,0,0,5"/>
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox x:Name="blacklist_input" Grid.Column="0" Background="#11888888" Foreground="{Binding ElementName=window, Path=Tag}" BorderBrush="#333" BorderThickness="1" Padding="5" VerticalContentAlignment="Center" Height="30"/>
                                        <Button Grid.Column="1" Content="+" Click="add_to_blacklist_manual" Style="{StaticResource navButton}" Margin="5,0,0,0" Padding="10,0" Height="30"/>
                                    </Grid>
                                    <Border Background="#11000000" CornerRadius="5" Height="150" BorderBrush="#333" BorderThickness="1">
                                        <ScrollViewer>
                                            <ItemsControl x:Name="blacklist_box">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="5">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBlock Text="{Binding}" Foreground="#888" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                            <Button Grid.Column="1" Content="x" Click="remove_from_blacklist" Foreground="#ff5555" Margin="5,0,0,0" Style="{StaticResource navButton}" Padding="5,0"/>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>
                                    </Border>
                                </StackPanel>
                                <Button Content="сброс данных" Click="reset" Background="#550000" Foreground="White" Margin="0,30,0,0" Padding="10" HorizontalAlignment="Left"/>
                            </StackPanel>
                         </ScrollViewer>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
